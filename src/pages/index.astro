---
import Hero from '@/components/common/Hero.astro';
import BaseLayout from "@/layouts/BaseLayout.astro";
import ContentMasonry from "@/components/common/ContentMasonry.astro";
import { getContentItems } from "@/utils/content-utils";
import { collections } from "@/content.config";

// Dynamically fetch content groups
const previewCount = 6;
const collectionKeys = Object.keys(collections);

const groups = await Promise.all(
  collectionKeys.map(async (key) => {
    const items = await getContentItems(key as any);
    const title = key.charAt(0).toUpperCase() + key.slice(1);

    return {
      title,
      count: items.length,
      viewAllLink: `/${key}`,
      items: items.slice(0, previewCount),
      type: key
    };
  })
);

// Filter out empty groups if desired
const nonEmptyGroups = groups.filter(g => g.count > 0);

import { getAllThoughts } from "@/utils/content-utils";
import ThoughtsFeed from "@/components/common/ThoughtsFeed.astro";

const recentThoughts = await getAllThoughts();
---

<BaseLayout
  pageTitle="Home"
  pageDescription="Trying to define what's meaningful to me"
>
  <Hero
		subtitle="Trying to define what's meaningful to me"
		size="is-small"
    primary
	/>

  <section style="padding-top: 1rem; padding-bottom: 2rem;">
      <div class="container">
          <h3 class="title is-5 mb-3">Latest Thinks</h3>
          <ThoughtsFeed thoughts={recentThoughts} limit={10} />
      </div>
  </section>

  <section>
    <div class="container">
      <ContentMasonry groups={nonEmptyGroups} />
    </div>
  </section>
</BaseLayout>
