---
import { type ThoughtItem } from '@/utils/content-utils';
import { type ContentType } from '@/utils/content-utils';

interface Props {
	thoughts: ThoughtItem[];
	limit?: number;
}

const { thoughts, limit } = Astro.props;
const displayThoughts = limit ? thoughts.slice(0, limit) : thoughts;

function formatTimestamp(timestamp: string): string {
	const date = new Date(Number(timestamp) * 1000);
	return date.toLocaleDateString('en-US', {
		month: 'short',
		day: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
	});
}

function getTypeLabel(type: ContentType): string {
    const map: Record<string, string> = {
        movies: 'Movie',
        shows: 'Show',
        people: 'Person',
        projects: 'Project',
        tools: 'Tool'
    };
    return map[type] || type;
}

function getUrl(item: ThoughtItem['thing']): string {
    const base = `/${item.type}`;
    // If it has a category/parent structure, we might need to handle that,
    // but usually the slug is unique enough or built correctly.
    // Ideally we should use a utility to build the URL properly.
    // For now assuming /{type}/{slug} works.
    return `${base}/${item.slug}`;
}
---

{displayThoughts.length > 0 && (
	<div class="thoughts-feed">
        <div class="feed-container">
            {displayThoughts.map((thought) => (
                <div class="feed-item">
                    <div class="feed-header">
                        <span class="feed-context">
                            <span class="type-tag">{getTypeLabel(thought.thing.type)}</span>
                            <span class="separator">on</span>
                            <a href={getUrl(thought.thing)} class="thing-link">{thought.thing.title}</a>
                        </span>
                        <time class="feed-date">{formatTimestamp(thought.timestamp)}</time>
                    </div>
                    <div class="feed-content">
                         {typeof thought.content === 'string' ? (
                            <p>{thought.content}</p>
                        ) : (
                            <p>{JSON.stringify(thought.content)}</p>
                        )}
                    </div>
                </div>
            ))}
        </div>
	</div>
)}

<style>
	.thoughts-feed {
		width: 100%;
        overflow-x: auto;
        scrollbar-width: thin;
	}

    .feed-container {
        display: flex;
        gap: 1.5rem;
        padding: 0.5rem 0;
    }

    .feed-item {
        flex: 0 0 375px; /* Fixed width cards */
        /* TODO: Explore options for shrinking items with less content. */

        background: #fff;
        border: 1px solid #eee;
        border-radius: 8px;
        padding: 1rem;
        box-shadow: 0 2px 4px rgba(0,0,0,0.15);
        display: flex;
        flex-direction: column;
    }

    .feed-header {
        display: flex;
        justify-content: space-between;
        align-items: baseline;
        margin-bottom: 0.75rem;
        font-size: 0.85rem;
        border-bottom: 1px solid #f5f5f5;
        padding-bottom: 0.5rem;
    }

    .feed-context {
        display: flex;
        flex-direction: column;
        gap: 0.2rem;
    }

    .type-tag {
        text-transform: uppercase;
        font-size: 0.65rem;
        font-weight: 700;
        color: #999;
        letter-spacing: 0.05em;
    }

    .separator {
        display: none; /* hidden for stacking look */
    }

    .thing-link {
        font-weight: 600;
        color: #2c3e50;
        text-decoration: none;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        max-width: 300px;
    }

    .thing-link:hover {
        color: hsl(171, 100%, 41%);
        text-decoration: underline;
    }

    .feed-date {
        font-size: 0.75rem;
        color: #aaa;
        white-space: nowrap;
    }

    .feed-content {
        font-size: 0.95rem;
        line-height: 1.5;
        color: #444;
        /* Limit height/lines if needed */
        max-height: 150px;
        overflow-y: auto;
    }

    .feed-content p {
        margin: 0;
    }
</style>
